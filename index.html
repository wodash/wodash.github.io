<!DOCTYPE html>
<html lang="en">

<head>

	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="">
	<meta name="author" content="">

	<title>Wodash</title>

	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">

	<!--Bootswatch solar theme bootstrap css-->
	<link rel="stylesheet" type="text/css" href="bootstrap.min.css" />

	<!-- dataTables and bootstrap CSS  & -->
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.18/css/dataTables.bootstrap4.min.css" />
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/responsive/2.2.2/css/responsive.bootstrap4.min.css" />

	<!-- Custom Fonts -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.8.0/css/all.min.css" rel="stylesheet" type="text/css">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

	<!-- Custom CSS -->
	<link href="styles.css" rel="stylesheet">

	<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
	<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body style="padding-top: 4rem">
	<!-- Navigation -->
	<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" role="navigation">
		<a class="navbar-brand" href="#">HoV</a>
		<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
			<span class="navbar-toggler-icon"></span>
		</button>
		<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
			<div class="navbar-nav">
				<a class="nav-item nav-link active" href="#companionListContainer">Companions <span class="sr-only">(current)</span></a>
				<a class="nav-item nav-link" href="#roosterTableContainer">Rooster</a>
				<a class="nav-item nav-link" href="#academyContainer">Academy</a>
				<a class="nav-item nav-link" href="https://airtable.com/tbl13PIRQ4xGDv9wW/viwUI8EqQ59JPQuCl?blocks=hide" target="_blank">AirTable</a>
			</div>
		</div>
	</nav>

	<main class="col-12 bd-content">
		<div><br></div>
		<div id="loadingMessage" class="jumbotron" style="padding-top: 50px">
			<div class="container d-flex justify-content-center">
				<div class="progress" style="height: 30px">
					<div class="progress-bar progress-bar-striped bg-info progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%; padding: 8px 30px 2px 30px">
						<h4 style="color: azure">Loading Data...</h4>
					</div>
				</div>
			</div>
		</div>
		<div id="companionListContainer" class="jumbotron" style="display: none;">
			<div>
				<h2>COMPANIONS</h2>
			</div><br>
			<form id="companionFilter">
				<div>
					<div class="input-group input-group-sm mb-3">
						<input id="NameFlt" class="form-control" type="text" placeholder="Name" />
					</div>
				</div>
			</form>
			<div class="card">
				<div class="card-body align-items-center">
					<div id="companionBtns" class="col-">
						<!--dynamic content-->
					</div>
				</div>
			</div>
		</div>
		<div id="roosterTableContainer" class="jumbotron" style="display: none;">
			<div>
				<h2>ROOSTER <button id="refreshTable" class="btn btn-sm btn-outline-secondary" type="button"> <i class="fas fa-sync"></i></button></h2>
			</div><br>
			<form id="simpleSearch">
				<div>
					<div class="input-group input-group-sm mb-3">
						<input id="NameSr" class="form-control" type="text" placeholder="Name" />
						<div class="input-group-append">
							<button class="btn btn-outline-secondary" type="button" data-toggle="collapse" data-target="#advSearch">Expand</button>
						</div>
					</div>
				</div>
			</form>
			<form id="advSearch" class="collapse" style="padding-bottom: 10px;">
				<div class="card card-body form-row align-items-center" style="flex-direction: unset;">
					<input id="StarsSr" class="form-control" type="text" placeholder="Stars" style="width : 80px;font-size: .8rem;" />
					<input id="CurrLvlSr" class="form-control" type="text" placeholder="Curr lvl" style="width : 80px;font-size: .8rem;" />
					<input id="SpecialitySr" class="form-control" type="text" placeholder="Speciality" style="width : 120px;font-size: .8rem;" />
					<input id="RoosteredSr" class="form-control" type="text" placeholder="Yes,No" style="width : 90px;font-size: .8rem;" />
					<input id="TypeSr" class="form-control" type="text" placeholder="Human, Vampire" style="width : 130px;font-size: .8rem;" />
					<input id="DiciplineSr" class="form-control" type="text" placeholder="Magic, Melee, Ranged" style="width : 200px;font-size: .8rem;" />
				</div>
			</form>
			<table id="rooster" class="table table-striped table-bordered" style="width:100%">
				<!--dynamic Content-->
			</table>
		</div>

		<div id="academyContainer" class="jumbotron" style="display: none;">
			<div>
				<h2>ACADEMY</h2>
			</div><br>
			<div id="knightClass" class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-sm">
							<h4 class="card-title">Knight Class</h4>
						</div>
						<div class="col-sm">
							<div class="btnContainer col-sm">
								<!--dynamic content-->
							</div>
						</div>
					</div>
				</div>
				<div id="knightBody" class="courseContainer card-body">
					<!--dynamic content-->
				</div>
			</div>
			<div id="archerClass" class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-sm">
							<h4 class="card-title">Archer Class</h4>
						</div>
						<div class="btnContainer col-sm">
							<!--dynamic content-->
						</div>
					</div>
				</div>
				<div id="archerBody" class="courseContainer card-body">
					<!--dynamic content-->
				</div>
			</div>
			<div id="wizardClass" class="card">
				<div class="card-body">
					<div class="row">
						<div class="col-sm">
							<h4 class="card-title">Wizard Class</h4>
						</div>
						<div class="btnContainer col-sm">
							<!--dynamic content-->
						</div>
					</div>
				</div>
				<div id="wizardBody" class="courseContainer card-body">
					<!--dynamic content-->
				</div>
			</div>
			<div hidden>
				<div id="sampleCourse" class="row">
					<div class="courseName col-sm">Course Name</div>
					<div class="col-sm">
						<ul class="levels pagination pagination-sm" style="margin-bottom: 2px;">
							<!--<li class="page-item active">
						<span class="page-link">1</span>
					</li>-->
						</ul>
					</div>
					<div class="companions col-sm">
						<!--<span class="badge badge-primary float-right m-1 ">Primary</span>
				<span class="badge badge-success float-right m-1 ">Success</span>
				<span class="badge badge-danger float-right m-1">Danger</span
				<span class="badge badge-pill badge-info">Info</span>>-->
					</div>
				</div>
				<div id="classBtns" class="btn-group btn-group-toggle float-right" data-toggle="buttons">
					<label class="levelBtn btn btn-primary">
						<input type="radio" name="options" autocomplete="off"> 1
					</label>
					<label class="levelBtn btn btn-primary">
						<input type="radio" name="options" autocomplete="off"> 2
					</label>
					<label class="levelBtn btn btn-primary">
						<input type="radio" name="options" autocomplete="off"> 3
					</label>
					<label class="levelBtn btn btn-primary">
						<input type="radio" name="options" autocomplete="off"> 4
					</label>
					<label class="levelBtn btn btn-primary">
						<input type="radio" name="options" autocomplete="off"> 5
					</label>
				</div>
				<div id="m-r-sample" class="card">
					<label id="" class="m-summary control-label" style="padding: 5px 0 0 10px">summary</label>
					<form class="card-body form-row align-items-center" style="flex-direction: unset;" onsubmit="return mySubmitFunction(event)">
						<div class="input-group input-group-sm mb-1" style="max-width: 30%">
							<div class="input-group-prepend">
								<span class="input-group-text">Stars</span>
							</div>
							<input id="" type="number" class="m-stars form-control" min="1" max="5" required>
						</div>
						<div class="input-group input-group-sm mb-1" style="max-width: 35%">
							<div class="input-group-prepend">
								<span class="input-group-text">Curr</span>
							</div>
							<input id="" type="number" class="m-curr form-control" min="1" required>
						</div>
						<div class="input-group input-group-sm mb-1" style="max-width: 35%">
							<div class="input-group-prepend">
								<span class="input-group-text">Max</span>
							</div>
							<input id="" type="number" class="m-max form-control" min="1" required>
						</div>
						<div class="input-group input-group-sm mb-1" style="max-width: 50%">
							<div class="input-group-prepend">
								<span class="input-group-text">Type</span>
							</div>
							<select id="" class="m-type custom-select">
								<option value="Human">Human</option>
								<option value="Vampire">Vampire</option>
								<option value="Other">Other</option>
							</select>
						</div>
						<div class="mb-1" style="max-width: 50%; padding-left: 10px">
							<button type="submit" class="update btn btn-sm btn-outline-success">Update</button>
							<button type="button" class="delete btn btn-sm btn-outline-danger">Delete</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</main>
	<!-- Modal -->
	<div class="modal fade" id="modalBox" tabindex="-1" role="dialog" aria-hidden="true">
		<div class="modal-dialog modal-dialog-scrollable" role="document">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="m-name text-success">Name</h5>
					<button type="button" class="close" data-dismiss="modal" aria-label="Close">
						<span aria-hidden="true">&times;</span>
					</button>
				</div>
				<div class="modal-body">
					<div class="row">
						<label for="m-title" class="col-2 col-form-label"><b>Title</b></label>
						<div class="col-10">
							<input id="" type="text" readonly="" class="m-title text-info form-control-plaintext">
						</div>
					</div>
					<div class="row">
						<label for="m-specialization" class="col-4 col-form-label"><b>Specialization</b></label>
						<div class="col-8">
							<input id="" type="text" readonly="" class="m-specialization text-info form-control-plaintext">
						</div>
					</div>
					<div class="row">
						<label for="m-course" class="col-2 col-form-label"><b>Course</b></label>
						<div class="col-10">
							<input id="" type="text" readonly="" class="m-Courses text-info form-control-plaintext">
						</div>
					</div>
					<div class="m-rooster">
						<!--Dynamic Content-->
					</div>
					<div class="row card" style="background-color: transparent; padding-top: 15px">
						<button type="button" class="addnew btn btn-outline-primary btn-sm mb-1">Add New</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!--End of Body content-->
	<!-- jQuery, bootstrap, dataTables, datatable bootstrap JavaScript -->
	<script type="text/javascript" src="https://cdn.datatables.net/v/bs4-4.1.1/jq-3.3.1/dt-1.10.18/r-2.2.2/datatables.min.js"></script>

	<!-- popper.js -->
	<script src="https://unpkg.com/popper.js/dist/umd/popper.min.js"></script>

	<!-- airtable js-->
	<script src="airpuck.js"></script>

	<!-- custom script -->
	<script>
		var airPuckOptions = {
			name: "",
			baseID: "apphZcr3uil7ShzdH",
			apiKey: "key4Dgc4mV6YNi1vm"
		};
		var advSearch = $('#advSearchBtn');
		var $loader = $('#loadingMessage');
		var $table = $('#rooster');
		var roosterTable_AP, companionsTable_AP, specializationTable_AP, coursesTable_AP, academyTable_AP;
		var processingCount = 0;

		$('#advSearchBtn').click(function() {
			$('#advSearch').toggle();
		})

		$('#refreshTable').click(function() {
			prepareRoosterTableData();
		})

		function mySubmitFunction(e) {
			e.preventDefault();

			return false;
		}

		$.fn.dataTable.Api.registerPlural('columns().names()', 'column().name()', function(setter) {
			return this.iterator('column', function(settings, column) {
				var col = settings.aoColumns[column];
				if (setter !== undefined) {
					col.sName = setter;
					return this;
				} else {
					return col.sName;
				}
			}, 1);
		});

		function beginProcessing() {
			if (processingCount == 0)
				$loader.show();
			processingCount = processingCount + 1;
		}

		function endProcessing() {
			if (processingCount > 0)
				processingCount = processingCount - 1;

			if (processingCount == 0)
				$loader.hide();
		}

		function fetchAllData() {
			beginProcessing();
			airPuckOptions.name = "Specializations";
			specializationTable_AP = new Airpuck.Table(airPuckOptions, function() {
				/* This is the callback after successful initialization */
				airPuckOptions.name = "Companions";
				companionsTable_AP = new Airpuck.Table(airPuckOptions, function() {
					/* This is the callback after successful initialization */
					airPuckOptions.name = "Rooster";
					roosterTable_AP = new Airpuck.Table(airPuckOptions, function() {
						/* This is the callback after successful initialization */
						airPuckOptions.name = "Courses";
						coursesTable_AP = new Airpuck.Table(airPuckOptions, function() {
							/* This is the callback after successful initialization */
							airPuckOptions.name = "Academy";
							academyTable_AP = new Airpuck.Table(airPuckOptions, function() {
								/* This is the callback after successful initialization */
								//$loader.hide();
								endProcessing();
								prepareCompanionData();
								prepareRoosterTableData();
								loadAcademyData();
							});
						});
					});
				});
			});

		}

		function prepareCompanionData() {
			$("#NameFlt").keyup(function() {
				loadCompanionData($(this).val());
			});
			$('.update').click(function() {
				var parentDiv = $(this).parents(".card");
				updateRooster(parentDiv);
			});
			$('.delete').click(function() {
				var parentDiv = $(this).parents(".card");
				deleteRooster(parentDiv);
			});
			$('#modalBox').on('show.bs.modal', function(event) {
				var button = $(event.relatedTarget); // Button that triggered the modal
				var modal = $(this);
				var companionData = companionsTable_AP.getLocalRecordById(button[0].id);
				modal.attr("recId", companionData.id);
				companionData = companionData.fields;
				modal.find('.m-name').text(companionData.Name);
				modal.find('.m-title').val(companionData.Title);

				if (companionData.Courses == undefined)
					modal.find('.m-Courses').val("undefined");
				else {
					var courseData = coursesTable_AP.getLocalRecordById(companionData.Courses[0]);
					courseData = courseData.fields;
					modal.find('.m-Courses').val(courseData.Course);
				}

				if (companionData.Specialization == undefined)
					modal.find('.m-specialization').val("undefined");
				else {
					var splData = specializationTable_AP.getLocalRecordById(companionData.Specialization[0]);
					splData = splData.fields;
					modal.find('.m-specialization').val(splData.Specializations + " [ " + splData.Discipline + " - " + splData.Lvl + " ]");
				}
				modal.find('.m-rooster').empty();
				if (companionData.Rooster == undefined) {
					// do nothing
				} else {
					companionData.Rooster.forEach(function(item, index) {
						var rstData = roosterTable_AP.getLocalRecordById(item);
						addRoosterCard(rstData, modal);
					});
				}
				modal.find('.addnew').click(function() {
					console.log("clicked")
					var roosterTemplate = $('#m-r-sample').clone(true, true);
					$(roosterTemplate).prop("id", "");
					modal.find('.m-rooster').append(roosterTemplate);
				});

			});
			$('#companionListContainer').show();
		}

		function addRoosterCard(rstData, modal) {
			var roosterTemplate = $('#m-r-sample').clone(true, true);
			$(roosterTemplate).prop("id", rstData.id);
			rstData = rstData.fields;
			$(roosterTemplate).find(".m-summary").text(rstData["Summary"]);
			$(roosterTemplate).find(".m-curr").val(rstData["Curr Lvl"]);
			$(roosterTemplate).find(".m-max").val(rstData["Max Lvl"]);
			$(roosterTemplate).find(".m-stars").val(rstData["Stars"]);
			$(roosterTemplate).find(".m-type").val(rstData["Type"]);
			modal.find('.m-rooster').append(roosterTemplate);
		}

		function updateRooster(parentDiv) {
			var rstData = roosterTable_AP.getLocalRecordById(parentDiv.prop("id"));
			if (rstData == undefined) {
				// start add flow
				var newRooster = roosterTable_AP.makeRecord();
				newRooster['Curr Lvl'] = parseInt(parentDiv.find(".m-curr").val());
				newRooster['Max Lvl'] = parseInt(parentDiv.find(".m-max").val());
				newRooster['Stars'] = parseInt(parentDiv.find(".m-stars").val());
				newRooster['Type'] = parentDiv.find(".m-type").val();
				newRooster['Roostered'] = "Yes";
				newRooster['Name'] = [parentDiv.parents(".modal").attr("recId")];
				delete newRooster['Summary'];
				if (isNaN(newRooster['Curr Lvl']) || isNaN(newRooster['Max Lvl']) || isNaN(newRooster['Stars'])) {
					// form incomplete, do not add record
					console.log("error?");
				} else {
					// add record
					roosterTable_AP.add(newRooster, function() {
						var modal = parentDiv.parents(".modal")
						parentDiv.remove();
						console.log(roosterTable_AP.currentRecord.fields.Name[0])
						var compRec = companionsTable_AP.getLocalRecordById(roosterTable_AP.currentRecord.fields.Name[0]);
						companionsTable_AP.updateLocalRecord(compRec, function() {
							console.log("done");
						})
						addRoosterCard(roosterTable_AP.currentRecord, modal);
					});
				}
			} else {
				// start update flow
				var data = {
					"Stars": parseInt(parentDiv.find(".m-stars").val()),
					"Curr Lvl": parseInt(parentDiv.find(".m-curr").val()),
					"Max Lvl": parseInt(parentDiv.find(".m-max").val()),
					"Type": parentDiv.find(".m-type").val()
				};
				roosterTable_AP.update(rstData, data, function() {
					// callback after successful response from the server
				});
			}
		}

		function deleteRooster(parentDiv) {
			var rstData = roosterTable_AP.getLocalRecordById(parentDiv.prop("id"));
			if (rstData == undefined) {
				parentDiv.hide(400, function() {
					parentDiv.remove();
				})
			} else {
				roosterTable_AP.remove(rstData, function() {
					parentDiv.hide(400, function() {
						parentDiv.remove();
					})
				});
			}
		}

		function loadCompanionData(searchStr) {
			if (searchStr.length > 1) {
				var companions = companionsTable_AP.getLocalRecordListbyField("Name", searchStr, "Filter");
				$("#companionBtns").empty();
				companions.forEach(function(item, index) {
					$("#companionBtns").append(getCompanionButtonTag(item));
				});
			} else {
				$("#companionBtns").empty();
			}
		}

		function prepareRoosterTableData() {
			var roosterData = [];
			roosterTable_AP.records.forEach(function(item, index) {
				var companion = companionsTable_AP.getLocalRecordById(item.fields.Name[0]);
				var specialization = specializationTable_AP.getLocalRecordById(companion.fields.Specialization[0]);
				var entry = {
					recId: item.id,
					CurrLvl: item.fields["Curr Lvl"],
					MaxLvl: item.fields["Max Lvl"],
					Roostered: item.fields["Roostered"],
					Stars: item.fields["Stars"],
					Type: item.fields["Type"],
					Name: getNameTag(item, companion),
					Title: companion.fields.Title,
					Dicipline: specialization.fields["Discipline"],
					Speciality: getSpecialityTag(specialization),
					Info: getInfoTag(specialization, item)
				}
				roosterData.push(entry)
			})
			console.log($.fn.DataTable.isDataTable($table))
			if (!$.fn.DataTable.isDataTable($table)) {
				console.log("initial")
				loadRoosterTable(roosterData)
			} else {
				console.log("re draw")
				var table = $table.DataTable();
				table.clear();
				table.rows.add(roosterData);
				table.draw();
			}

		}

		function loadRoosterTable(rTableData) {

			var table = $table.DataTable({
				data: rTableData,
				columns: [{
						title: 'Name',
						name: 'Name',
						data: 'Name',
						className: 'all'
					},
					{
						title: '<i class="fas fa-star"></i>',
						name: 'Stars',
						data: 'Stars',
						width: '40px',
						className: 'all'
					},
					{
						title: 'Title',
						name: 'Title',
						data: 'Title',
						orderable: false,
						className: 'desktop'

					},
					{
						title: 'Speciality',
						name: 'Speciality',
						data: 'Speciality',
						orderable: false,
						className: 'desktop'
					},
					{
						title: 'Current Lvl',
						name: 'CurrLvl',
						data: 'CurrLvl',
						className: 'desktop'
					},
					{
						title: 'Max Lvl',
						name: 'MaxLvl',
						data: 'MaxLvl',
						className: 'desktop'
					},
					{
						title: 'Info',
						name: 'Info',
						data: 'Info',
						orderable: false,
						className: 'mobile'
					},
					{
						name: 'Type',
						data: 'Type',
						className: 'never',
					},
					{
						name: 'Dicipline',
						data: 'Dicipline',
						className: 'never',
					},
					{
						name: 'Roostered',
						data: 'Roostered',
						className: 'never',
					}
				],
				dom: 'irtlp',
				responsive: {
					details: false
				}
			});

			table.columns().every(function() {
				var that = this;
				var colName = this.context[0].aoColumns[this.index()].sName;
				var id = "#" + colName + "Sr";
				$(id).on('keyup change', function() {
					if (that.search() !== this.value) {
						that.search(this.value).draw();
					}
				});
			});

			$('#roosterTableContainer').show();
		}

		function getCompanionBadge(companionId, level, ignore) {
			var companion = companionsTable_AP.getLocalRecordById(companionId);
			var classToAdd = "badge-danger";
			if (ignore)
				classToAdd = "badge-info";
			else if (level >= 1 && level <= 5) {
				var comList = roosterTable_AP.getLocalRecordListbyField("Name", companionId, "Search");
				comList.forEach(function(item, index) {
					if (item.fields.Stars === level) {
						if (item.fields.Roostered === "Yes") {
							classToAdd = "badge-success";
						}
					}
				});
			}
			return getCompanionBadgeTag(classToAdd, companion.fields["Name"]);

		}

		function updateCompanions(filtered, level, courseContainerTag) {
			filtered.forEach(function(item, index) {
				var courseInfo = coursesTable_AP.getLocalRecordById(item.fields.Course[0]);
				var CompanionIds = courseInfo.fields.Companions;
				var companionsTag = $(courseContainerTag).find("#" + courseInfo.id).find(".companions");
				var ignore = false;
				if (item.fields["Level " + level] === "Yes")
					ignore = true;
				companionsTag.empty();
				CompanionIds.forEach(function(item, index) {
					$(companionsTag).append(getCompanionBadge(item, level, ignore));
				});
			});
		}

		function loadAcademyData(academyFields) {

			var buttonContainer = $("#classBtns").clone().appendTo(".btnContainer");
			academyTable_AP.records.forEach(function(item, index) {
				var courseInfo = coursesTable_AP.getLocalRecordById(item.fields.Course[0]);
				var courseTemplate = $("#sampleCourse").clone();
				$(courseTemplate).prop("id", courseInfo.id);
				$(courseTemplate).find(".courseName").text(courseInfo.fields.Course);
				$(courseTemplate).find(".levels").empty()
				$(courseTemplate).find(".levels").append(getLevelTag(item, "Level 1"))
				$(courseTemplate).find(".levels").append(getLevelTag(item, "Level 2"))
				$(courseTemplate).find(".levels").append(getLevelTag(item, "Level 3"))
				$(courseTemplate).find(".levels").append(getLevelTag(item, "Level 4"))
				$(courseTemplate).find(".levels").append(getLevelTag(item, "Level 5"))

				if (item.fields.Master === "Knight class") {
					$(courseTemplate).appendTo("#knightBody");
				}
				if (item.fields.Master === "Archer class") {
					$(courseTemplate).appendTo("#archerBody");
				}
				if (item.fields.Master === "Wizard class") {
					$(courseTemplate).appendTo("#wizardBody");
				}
			});

			$(".levelBtn").click(function() {
				var classType = $(this).closest(".card").prop("id");
				var level = $.trim($(this).text());
				level = parseInt(level);
				var courseContainerTag = $('#' + classType).find(".courseContainer")
				if (classType === "knightClass") {
					var filtered = academyTable_AP.getLocalRecordListbyField("Master", "Knight class", "Search");
					updateCompanions(filtered, level, courseContainerTag);
				} else if (classType === "archerClass") {
					var filtered = academyTable_AP.getLocalRecordListbyField("Master", "Archer class", "Search");
					updateCompanions(filtered, level, courseContainerTag);
				} else if (classType === "wizardClass") {
					var filtered = academyTable_AP.getLocalRecordListbyField("Master", "Wizard class", "Search");
					updateCompanions(filtered, level, courseContainerTag);
				}
			});

			endProcessing();
			$('#academyContainer').show();
		}

		/**** Tag Helpers ****/
		function getLevelTag(item, level) {
			var active = item.fields[level];
			//console.log(level.split(" "))
			if (active === "Yes") {
				return "<li class='page-item active'><span class='page-link'>" + level.split(" ")[1] + "</span></li>";
			} else if (active === "No") {
				return "<li class='page-item'><span class='page-link'>" + level.split(" ")[1] + "</span></li>";
			}
		}

		function getNameTag(roosterItem, companionObj) {
			return "<div class='roost" + roosterItem.fields["Roostered"] + " " + roosterItem.fields["Type"] + "'>" + companionObj.fields["Name"] + "</div>";
		}

		function getSpecialityTag(specializationObj) {
			return "<div class='" + specializationObj.fields["Discipline"] + "'>" + specializationObj.fields["Specializations"] + "</div>";
		}

		function getCompanionButtonTag(companionObj) {
			return "<button id='" + companionObj.id + "' type='button' data-toggle='modal' data-target='#modalBox' class='btn btn-outline-info btn-sm btn-comp'>" + companionObj.fields.Name + "</button>";
		}

		function getCompanionBadgeTag(classToAdd, companionName) {
			return "<span class='badge " + classToAdd + " float-right m-1'>" + companionName + "</span>";
		}

		function getInfoTag(specializationObj, roosterItem) {
			let discip = specializationObj.fields["Discipline"];
			let special = specializationObj.fields["Specializations"];
			let levelInfo = " (" + roosterItem.fields["Curr Lvl"] + " &#47; " + roosterItem.fields["Max Lvl"] + ")";
			return "<div class='" + discip + "' style='font-size: small;'>" + special + levelInfo + "</div>"
		}

		// self executing function here
		$(document).ready(function() {
			// your page initialization code here
			// the DOM will be available here
			console.log("Page Loaded")
			//beginProcessing();
			fetchAllData();
		});

	</script>

</body>

</html>
